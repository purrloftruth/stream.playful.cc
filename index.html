<!DOCTYPE html>
<!-- :D -->
<html>
  <head>
    <title>Playful</title>

    <style type="text/css">
      body {
        padding: 0;
        margin: 0;
        background-color: #F38;
        color: #FFF;
        font-family: "Lato", Helvetica, sans-serif;
      }

      div#enclosure {
        position: relative;
        width: 100vw;
        height: 100vh;
      }
      div.clicker {
        color: #FFF;
        font-size: 192pt;
        height: 192pt;
        width: 192pt;
        margin: 0 auto;

        position: absolute;
        top: 50%;
        left: 50%;
        margin-top: -96pt;
        margin-left: -96pt;

      }

      div.now-playing {
        width: 80%;
        text-align: center;
        position: absolute;
 top: 50%;
 left: 50%;
 transform: translate(-50%, 96pt);
      }

      span#now-playing-data {
        font-weight: bold;
        font-size: 32pt;
      }

      span.fa {
        position: absolute;
        width: 192pt;
        height: 192pt;
        visibility: hidden;
        margin: 0 auto;
        text-align: center;
      }

      span.fa-circle-o-notch {
        visibility: visible;
        -webkit-animation-name: spin;
        -webkit-animation-duration: 1800ms;
        -webkit-animation-iteration-count: infinite;
        -webkit-animation-timing-function: linear;
        -moz-animation-name: spin;
        -moz-animation-duration: 1800ms;
        -moz-animation-iteration-count: infinite;
        -moz-animation-timing-function: linear;
        -ms-animation-name: spin;
        -ms-animation-duration: 18000ms;
        -ms-animation-iteration-count: infinite;
        -ms-animation-timing-function: linear;
      }

      /* thanks to
         http://stackoverflow.com/questions/14859322/css3-spin-animation */


      @-moz-keyframes spin {
        from { -moz-transform: rotate(0deg); }
        to { -moz-transform: rotate(360deg); }
      }
      @-webkit-keyframes spin {
        from { -webkit-transform: rotate(0deg); }
        to { -webkit-transform: rotate(360deg); }
      }
      @keyframes spin {
        from {transform:rotate(0deg);}
        to {transform:rotate(360deg);}
      }

      .player-enclosure {
        display: none;
      }
    </style>

    <script src="https://use.fontawesome.com/b5eb70532f.js"></script>
    <script src="js/jquery.js"></script>
    <script src="js/mediaelement/mediaelement-and-player.js"></script>

    <script src="https://use.typekit.net/isy1nuu.js"></script>
    <script>try{Typekit.load({ async: true });}catch(e){}</script>
  </head>

  <body>
    <div id="enclosure">
      <div class="player-enclosure">
        <audio src="http://stream.playful.cc/stream/audio" id="player"></audio>
      </div>

      <div class="clicker">
        <span id="b-load" class="b fa fa-circle-o-notch"></span>
        <span id="b-pause" class="b fa fa-pause-circle" onclick="player.pause();"></span>
        <span id="b-play" class="b fa fa-play-circle-o" onclick="player.play();"></span>
      </div>

      <div class="now-playing">
        <span id="now-playing-data"></span>
      </div>
    </div>

    <script>
        var player = new MediaElementPlayer('#player', {
          startVolume: 1.0,
          alwaysShowControls: false,
        });

        var statusUrl = "http://stream.playful.cc/stream/status-json.xsl"

        function updateTrack() {
          $.getJSON(statusUrl + "?t" + Date.now(), function(data) {
            if (data.icestats.source.title.localeCompare($("#now-playing-data").text())) {
              console.log("updating title to " + data.icestats.source.title);
              $("#now-playing-data").text(data.icestats.source.title);
            } else {
              /* console.log("title has not changed"); */
            }
          });
        }
        var trackUpdateCallback;

        $('#player').bind("stalled", function() {
          console.log("buffering");
          $('.b').css("visibility", "hidden");
          $('#b-load').css("visibility", "visible");
        });
        $('#player').bind("playing", function() {
          console.log("we have liftoff");
          $('.b').css("visibility", "hidden");
          $('#b-pause').css("visibility", "visible");
          updateTrack();
          trackUpdateCallback = window.setInterval(updateTrack, 5000);
        });
        $('#player').bind("pause", function() {
          console.log("we are paused");
          $('.b').css("visibility", "hidden");
          $('#b-play').css("visibility", "visible");
          clearInterval(trackUpdateCallback);
          $("#now-playing-data").text("Paused");
        });

        player.play();
    </script>
  </body>
</html>
