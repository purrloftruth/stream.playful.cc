<!DOCTYPE html>
<!-- :D -->
<html>
  <head>
    <title>Playful</title>

    <style type="text/css">
      body {
        padding: 0;
        margin: 0;
        background-color: #F38;
        color: #FFF;
        font-family: "Lato", Helvetica, sans-serif;
        font-size: 100%;

        overflow-x: hidden;
        overflow-y: hidden;
      }

      div#enclosure {
        position: relative;
        width: 100vw;
        height: 100vh;
      }
      div.clicker {
        color: #FFF;
        font-size: 192pt;
        height: 192pt;
        width: 192pt;
        margin: 0 auto;

        position: absolute;
        top: 50%;
        left: 50%;
        margin-top: -128pt;
        margin-left: -96pt;

      }

      div.now-playing {
        width: 80%;
        text-align: center;
        position: absolute;
 top: 50%;
 left: 50%;
 transform: translate(-50%, 64pt);
      }

      span#now-playing-data {
        font-weight: bold;
        font-size: 32pt;
      }

      span.b {
        position: absolute;
        width: 192pt;
        height: 192pt;
        visibility: hidden;
        margin: 0 auto;
        text-align: center;
      }

      span#b-pause, span#b-play {
        cursor: pointer;
      }

      span#b-load {
        visibility: visible;
        -webkit-animation-name: spin;
        -webkit-animation-duration: 1800ms;
        -webkit-animation-iteration-count: infinite;
        -webkit-animation-timing-function: linear;
        -moz-animation-name: spin;
        -moz-animation-duration: 1800ms;
        -moz-animation-iteration-count: infinite;
        -moz-animation-timing-function: linear;
        -ms-animation-name: spin;
        -ms-animation-duration: 18000ms;
        -ms-animation-iteration-count: infinite;
        -ms-animation-timing-function: linear;
      }

      /* thanks to
         http://stackoverflow.com/questions/14859322/css3-spin-animation */


      @-moz-keyframes spin {
        from { -moz-transform: rotate(0deg); }
        to { -moz-transform: rotate(360deg); }
      }
      @-webkit-keyframes spin {
        from { -webkit-transform: rotate(0deg); }
        to { -webkit-transform: rotate(360deg); }
      }
      @keyframes spin {
        from {transform:rotate(0deg);}
        to {transform:rotate(360deg);}
      }

      .player-enclosure {
        display: none;
      }

      div.volume-control {
        position: absolute;
        bottom: 0%;
        left: 0%;
        margin: 0;
        padding: 0.82em 1em;
      }
      input#volume {
        margin: 0;
        padding: 0;
        width: 128px;
      }

      div.footer {
        position: absolute;
        bottom: 0%;
        right: 0%;
        margin: 0;
        padding: 0.66em;
        opacity: 0.5;
      }

      div.footer span {
        font-size: 0.8em;

      }

      .wf-loading #enclosure {
        visibility: hidden;
      }
      .wf-active #enclosure {
        visibility: visible;
      }

      /* thanks to http://danielstern.ca/range.css  */
      input[type=range] {
        -webkit-appearance: none;
        width: 100%;
        margin: 5.5px 0;
        background-color: transparent;
      }
      input[type=range]:focus {
        outline: none;
      }
      input[type=range]::-webkit-slider-runnable-track {
        width: 100%;
        height: 4px;
        cursor: pointer;
        box-shadow: 0px 0px 0px rgba(0, 0, 0, 0), 0px 0px 0px rgba(13, 13, 13, 0);
        background-color: rgba(255, 255, 255, 0.5);
        border-radius: 2px;
        border: 0px solid rgba(0, 0, 0, 0);
      }
      input[type=range]::-webkit-slider-thumb {
        border: 0px solid #000000;
        height: 15px;
        width: 15px;
        border-radius: 15px;
        background: #ffffff;
        cursor: pointer;
        -webkit-appearance: none;
        margin-top: -5.5px;
      }
      input[type=range]:focus::-webkit-slider-runnable-track {
        background: rgba(255, 255, 255, 0.5);
      }
      input[type=range]::-moz-range-track {
        width: 100%;
        height: 4px;
        cursor: pointer;
        box-shadow: 0px 0px 0px rgba(0, 0, 0, 0), 0px 0px 0px rgba(13, 13, 13, 0);
        background: rgba(255, 255, 255, 0.5);
        border-radius: 2px;
        border: 0px solid rgba(0, 0, 0, 0);
      }
      input[type=range]::-moz-range-thumb {
        border: 0px solid #000000;
        height: 15px;
        width: 15px;
        border-radius: 15px;
        background: #ffffff;
        cursor: pointer;
      }
      input[type=range]::-ms-track {
        width: 100%;
        height: 4px;
        cursor: pointer;
        background: transparent;
        border-color: transparent;
        color: transparent;
      }
      input[type=range]::-ms-fill-lower {
        background: rgba(255, 255, 255, 0.5);
        border: 0px solid rgba(0, 0, 0, 0);
        border-radius: 4px;
        box-shadow: 0px 0px 0px rgba(0, 0, 0, 0), 0px 0px 0px rgba(13, 13, 13, 0);
      }
      input[type=range]::-ms-fill-upper {
        background: rgba(255, 255, 255, 0.5);
        border: 0px solid rgba(0, 0, 0, 0);
        border-radius: 4px;
        box-shadow: 0px 0px 0px rgba(0, 0, 0, 0), 0px 0px 0px rgba(13, 13, 13, 0);
      }
      input[type=range]::-ms-thumb {
        border: 0px solid #000000;
        height: 15px;
        width: 15px;
        border-radius: 15px;
        background: #ffffff;
        cursor: pointer;
      }
      input[type=range]:focus::-ms-fill-lower {
        background: rgba(255, 255, 255, 0.5);
      }
      input[type=range]:focus::-ms-fill-upper {
        background: rgba(255, 255, 255, 0.5);
      }


    </style>

    <script src="https://use.fontawesome.com/b5eb70532f.js"></script>
    <script src="js/jquery.js"></script>
    <script src="https://use.typekit.net/isy1nuu.js"></script>
    <script>try{Typekit.load({ async: false });}catch(e){}</script>
  </head>

  <body>
    <div id="enclosure">
      <div class="player-enclosure">
        <audio src="http://stream-source.playful.cc:21014/audio" id="player" type="audio/mp3"></audio>
      </div>

      <div class="clicker">
        <span id="b-load" class="b fa fa-circle-o-notch"></span>
        <span id="b-pause" class="b fa fa-pause-circle" onclick="pPause();"></span>
        <span id="b-play" class="b fa fa-play-circle-o" onclick="pPlay();"></span>
      </div>

      <div class="now-playing">
        <span id="now-playing-data"></span>
      </div>

      <div class="volume-control">
        <input id="volume" oninput="setVolume();" type="range" min="0" max="1" step="0.01" value="1">
      </div>

      <div class="footer">
        <span>&copy; 2016 Playful Collective. All Rights Reserved. Audio content streamed is &#8471; and &copy; its owner.</span>
      </div>

    </div>

    <script>
      var gPaused = false;
      var oldText = "";

      function pPlay() {
        console.log("pPlay");
        gPaused = false;
        $("#player").prop("volume", $("#volume").val());
        $("#player").trigger("play"); // just in case.
        $('.b').css("visibility", "hidden");
        $('#b-pause').css("visibility", "visible");
        $("#now-playing-data").text(oldText);
        updateTrack();
        trackUpdateCallback = window.setInterval(updateTrack, 5000);
      }

      function pPause() {
        console.log("pPause");
        gPaused = true;
        $("#player").prop("volume", 0);
        $('.b').css("visibility", "hidden");
        $('#b-play').css("visibility", "visible");
        clearInterval(trackUpdateCallback);
        oldText = $("#now-playing-data").text();
        $("#now-playing-data").text("Paused");
      }
      function setVolume() {
        if (!gPaused) {
          console.log("Volume call " + $("#volume").val());
          $("#player").prop("volume", $("#volume").val());
        } else {
          console.log("Volume called but we are paused");
        }
      }

      var statusUrl = "http://stream-source.playful.cc:21014/status-json.xsl"

      function updateTrack() {
        $.getJSON(statusUrl + "?t" + Date.now(), function(data) {
          if (data.icestats.source.title.localeCompare($("#now-playing-data").text())) {
            console.log("updating title to " + data.icestats.source.title);
            $("#now-playing-data").text(data.icestats.source.title);
          } else {
            /* console.log("title has not changed"); */
          }
        });
      }
      var trackUpdateCallback;

      $('#player').bind("stalled", function() {
        console.log("buffering");
        $('.b').css("visibility", "hidden");
        $('#b-load').css("visibility", "visible");
      });
      $('#player').bind("playing", function() {
        console.log("we have liftoff");
        $('.b').css("visibility", "hidden");
        $('#b-pause').css("visibility", "visible");
        $("#now-playing-data").text(oldText);
        updateTrack();
        trackUpdateCallback = window.setInterval(updateTrack, 5000);
      });
      $('#player').bind("pause", function() {
        console.log("we are actually paused");
        $('.b').css("visibility", "hidden");
        $('#b-play').css("visibility", "visible");
        clearInterval(trackUpdateCallback);
        oldText = $("#now-playing-data").text();
        $("#now-playing-data").text("Paused");
      });

      $('#player').trigger("play");
    </script>
  </body>
</html>
